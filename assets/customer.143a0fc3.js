var C=Object.defineProperty;var A=(t,u,a)=>u in t?C(t,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[u]=a;var r=(t,u,a)=>(A(t,typeof u!="symbol"?u+"":u,a),a);import{defineStore as n}from"https://esm.sh/pinia@^2.0.23";import o from"https://esm.sh/axios@^1.1.2";import{sha256 as F}from"https://esm.run/js-sha256@^0.9.0";const L={ACCOUNT_PWD_NULL_OR_EMPTY:"\u8D26\u53F7\u6216\u5BC6\u7801\u4E3A\u7A7A",ACCOUNT_OR_PWD_ERROR:"\u8D26\u53F7\u6216\u5BC6\u7801\u9519\u8BEF",LOGIN_SUCCESS:"\u767B\u5F55\u6210\u529F",NAME_ID_NUM_PWD_NULL_OR_EMPTY:"\u59D3\u540D\uFF0C\u8EAB\u4EFD\u8BC1\u6216\u5BC6\u7801\u4E3A\u7A7A",ENTER_TWICE_PWD_MISMATCH:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u5339\u914D\uFF01",ID_NUM_REPEATED:"\u8EAB\u4EFD\u8BC1\u53F7\u91CD\u590D",REG_SUCCESS:"\u6CE8\u518C\u6210\u529F",ID_NUM_FORMAT_ERROR:"\u8EAB\u4EFD\u8BC1\u53F7\u683C\u5F0F\u9519\u8BEF",LOGIN_REPEAT:"\u91CD\u590D\u767B\u5F55",NOT_LOGGED_ON:"\u60A8\u8FD8\u672A\u767B\u5F55",APPLY_SUCCESS:"\u7533\u8BF7\u6210\u529F",APPLY_FAILED:"\u7533\u8BF7\u5931\u8D25\uFF0C\u60A8\u4E0D\u7B26\u5408\u7533\u8BF7\u6761\u4EF6",APPLY_REPEAT:"\u91CD\u590D\u7533\u8BF7",DOES_NOT_APPLY:"\u6CA1\u6709\u7533\u8BF7\u6D3B\u52A8",SECKILL_NOT_STARTED:"\u79D2\u6740\u6D3B\u52A8\u8FD8\u672A\u5F00\u59CB",SECKILL_ENDED:"\u79D2\u6740\u6D3B\u52A8\u5DF2\u7ECF\u7ED3\u675F",PRODUCT_SOLD_OUT:"\u5546\u54C1\u5DF2\u7ECF\u552E\u5B8C",PURCHASE_REPEAT:"\u91CD\u590D\u8D2D\u4E70",INVALID_SECKILL_URL:"\u79D2\u6740\u94FE\u63A5\u9519\u8BEF",SECKILL_SUCCESS:"\u79D2\u6740\u6210\u529F\uFF0C\u6B63\u5728\u83B7\u53D6\u8BA2\u5355",PUT_ORDER_FAILED:"\u4E0B\u8BA2\u5355\u5931\u8D25",PURCHASE_SUCCESS:"\u652F\u4ED8\u6210\u529F\uFF0C\u5DF2\u4ECE\u60A8\u7684\u9ED8\u8BA4\u8D26\u53F7\u4E2D\u6263\u6B3E\uFF01",PURCHASE_FAILED:"\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8\uFF01"},D=class{};let s=D;r(s,"TARGET_BASE_URL","http://localhost"),r(s,"ACCOUNT_URL",D.TARGET_BASE_URL+":9010/customer"),r(s,"ACTIVITY_URL",D.TARGET_BASE_URL+":9030/seckillActivity"),r(s,"TOKEN_NAME","token");const e=o.create({timeout:1e4,withCredentials:!0});e.interceptors.request.use(t=>(console.log("request "+JSON.stringify({url:t.url,data:t.data},null,4)),t));e.interceptors.response.use(t=>{const u=t.data;return console.log("response "+JSON.stringify(u,null,4)),"code"in u&&"data"in u&&"message"in u?(u.code===500&&console.error(u.message),u):(console.error("\u8BF7\u6C42\u8FD4\u56DE\u503C\u7C7B\u578B\u9519\u8BEF\uFF01"),null)},t=>{console.error(t)});class E{static async loginByAccount(u){return await e.post(s.ACCOUNT_URL+"/login",{accountId:u.accountId,password:u.password})}static async loginByIdNumber(u){return await e.post(s.ACCOUNT_URL+"/login",{idNumber:u.idNumber,password:u.password})}static async register(u){return await e.post(s.ACCOUNT_URL+"/register",u)}static async getInfo(){return await e.post(s.ACCOUNT_URL+"/getInfo")}}class c{static hash(u){return F(u)}}class _{static validIdNum(u){return(u==null?void 0:u.length)===18&&/^\d+$/.test(u)||/^\d+$/.test(u==null?void 0:u.substring(0,17))&&/^[A-Za-z]+$/.test(u==null?void 0:u.charAt(17))}}const T=n("customer",{state:()=>({name:"",canApply:!1,applied:!1}),actions:{clearAll(){this.name="",this.canApply=!1,this.applied=!1,console.warn("customer: clear store!")},login(t){const{accountIdOrIdNumber:u}=t;return t.password=c.hash(t.password),_.validIdNum(u)?(t.idNumber=u,E.loginByIdNumber(t)):(t.accountId=u,E.loginByAccount(t))},register(t){return t.password=c.hash(t.password),E.register(t)},async getInfo(){if(this.name!=="")return console.log("customer: get from cache!"),{code:200,data:this.$state};const t=await E.getInfo();return t.code===200&&(this.$state=t.data),t}}});export{s as C,L as M,e as i,T as u};
